数据库笔记：

sql 语句：

单表查询


<_criteria xmlns="com.primeton.das.criteria">
	<_entity>TypeTest</_entity>
	<_select>
		<_field>dateType</_field>
		<_field>doubleType</_field>
		<_field>bigdecimalType</_field>
	</_select>
	<_expr>
		<!-- bigdecimalType 是实体TypeTest的一个属性。
                          这个结点对于_expr来说就是一个动态结点。
                   -->
                <!--=========================================
                   在GA版本里 可以用
                      <_property>bigdecimalType</_property>
                    来代替<bigdecimalType></bigdecimalType>
                 ===========================================-->
		<bigdecimalType></bigdecimalType>
		<_op>between</_op>
		<_min>2344234</_min>
		<_max>2344235</_max>
	</_expr>
        <_expr>
                <!--========================================
                   在GA版本里 可以用
                      <_property>intType</_property>
                    <_value>1,2,3,4</_value>
                    来代替<intType>1,2,3,4</intType>
                 ===========================================-->
		<intType>1,2,3,4</intType>
		<_op>in</_op>
	</_expr>
	<_expr>
		<dateType>20070320</dateType>
		<_pattern>yyyyMMdd</_pattern>
	</_expr>
	<_expr>
		<timestampType></timestampType>
		<_dateRule>year,month</_dateRule>
		<_year>2007</_year>
		<_month>3</_month>
	</_expr>
	<_orderby>
		<_property>typeId</_property>
		<_sort>asc</_sort>
	</_orderby>
	<_order>
		<_desc>timestampType</_desc>
	</_order>
	<_order>
		<_asc>dateType</_asc>
	</_order>
</_criteria>

上面的示例对应的sql：


select DATETYPE,DOUBLETYPE,BIGDECIMALTYPE from TYPETEST 
where
      BIGDECIMALTYPE between 2344234 and 2344235
      and INTTYPE in (1,2,3,4)
      and DATETYPE = to_date('2007-03-20','yyyy-MM-dd') 
      and TIMESTAMPTYPE between to_date('2007-03-01','yyyy-MM-dd') and to_date('2007-03-31','yyyy-MM-dd') 
order by TYPEID asc,TIMESTAMPTYPE desc, DATETYPE asc

如果需要通过页面提交数据来组装成这样的CriteriaEntity，页面上需要提交以下格式的数据。
 页面提交到的页面流action连线上必须有定义类型为"com.primeton.das.criteria.criteriaType"数据实体的_criteria变量。


<input type="hidden" name="_criteria/_entity" value="TypeTest" >
<input type="hidden" name="_criteria/_select/_field[1]" value="dateType" >
<input type="hidden" name="_criteria/_select/_field[2]" value="doubleType" />
<input type="hidden" name="_criteria/_select/_field[3]" value="bigdecimalType" >
<input type="hidden" name="_criteria/_expr[1]/bigdecimalType" value="" >
<input type="hidden" name="_criteria/_expr[1]/_op" value="between" >
<input type="hidden" name="_criteria/_expr[1]/_min" value="2344234" >
<input type="hidden" name="_criteria/_expr[1]/_max" value="2344235" >
<input type="hidden" name="_criteria/_expr[2]/intType" value="1,2,3,4" >
<input type="hidden" name="_criteria/_expr[2]/_op" value="in" >
<input type="hidden" name="_criteria/_expr[3]/dateType" value="20070320" >
<input type="hidden" name="_criteria/_expr[3]/_pattern" value="yyyyMMdd" >
<input type="hidden" name="_criteria/_expr[4]/timestampType" value="" >
<input type="hidden" name="_criteria/_expr[4]/_dateRule" value="year,month" >
<input type="hidden" name="_criteria/_expr[4]/_year" value="2007" >
<input type="hidden" name="_criteria/_expr[4]/_month" value="3" >
<input type="hidden" name="_criteria/_orderby[1]/_property" value="typeId" >
<input type="hidden" name="_criteria/_orderby[1]/_sort" value="asc" >
<input type="hidden" name="_criteria/_order[1]/_desc" value="timestampType" >
<input type="hidden" name="_criteria/_order[2]/_asc" value="dateType" >





 说明
按照XPath的规范，对于数组类型的属性，使用[]访问时，下标是从1开始；但是这些数据在内存中使用数组或List存放时，下标还是从0开始。 

以上通过页面提交的数据，也可以通过以下java代码完成：


DataObject criteriaType = DataFactory.INSTANCE.create
("com.primeton.das.criteria","criteriaType");
criteriaType.set("_entity","TypeTest");
criteriaType.set("_select/_field[1]","dateType");
criteriaType.set("_select/_field[2]","doubleType");
criteriaType.set("_select/_field[3]","bigdecimalType");
criteriaType.set("_expr[1]/bigdecimalType","");
criteriaType.set("_expr[1]/_op","between");
criteriaType.set("_expr[1]/_min","2344234");
criteriaType.set("_expr[1]/_max","2344235");
criteriaType.set("_expr[2]/intType","1,2,3,4");
criteriaType.set("_expr[2]/_op","in");
criteriaType.set("_expr[3]/dateType","20070320");
criteriaType.set("_expr[3]/_pattern","yyyyMMdd");
criteriaType.set("_expr[4]/timestampType","");
criteriaType.set("_expr[4]/_dateRule","year,month");
criteriaType.set("_expr[4]/_year","2007");
criteriaType.set("_expr[4]/_month","3");
criteriaType.set("_orderby[1]/_property","typeId");
criteriaType.set("_orderby[1]/_sort","asc");
criteriaType.set("_order[1]/_desc","timestampType");
criteriaType.set("_order[1]/_asc","dateType");
//然后调用基础构件库
com.eos.foundation.database.DatabaseUtil.queryEntitiesByCriteriaEntity("default",criteriaType);
//就可以从"default"数据源中查询相应的记录



select * from CITY where CITYID in (select PHONEID from PHONE)

<_criteria xmlns="com.primeton.das.criteria">
	<_entity>City</_entity>
	<_expr>
		<cityId></cityId>
		<_op>in</_op>
		<_ref>1</_ref>
	</_expr>
	<_ref>
		<_id>1</_id>
		<_entity>Phone</_entity>
		<_select>
			<_field>phoneId</_field>
		</_select>
	</_ref>
</_criteria>


//我的事务管理筛选。
select * from SUDA_BUSINESS where businessid in (select partyid from SUDA_RESAUTH where resid='90569')

<_criteria xmlns="com.primeton.das.criteria">
	<_entity>SUDA_BUSINESS</_entity>
	<_expr>
		<businessid></businessid>
		<_op>in</_op>
		<_ref>1</_ref>
	</_expr>
	<_ref>
		<_id>1</_id>
		<_entity>SUDA_RESAUTH</_entity>
		<_select>
			<_field>partyid</_field>
		</_select>
		<_expr>
		<resid></resid>
		<_op>=</_op>
		</_expr>
	</_ref>
</_criteria>



<input type="hidden" name="_criteria/_entity" value="SUDA_BUSINESS" >
<input type="hidden" name="_criteria/_expr[1]/businessid" value="" >
<input type="hidden" name="_criteria/_expr[1]/_op" value="in" >
<input type="hidden" name="_criteria/_expr[1]/_ref[1]" value="l" >
<input type="hidden" name="_criteria/_ref[1]/_id" value="l" >
<input type="hidden" name="_criteria/_ref[1]/_entity" value="SUDA_RESAUTH" >
<input type="hidden" name="_criteria/_ref[1]/_select/_field" value="partyid" >
<input type="hidden" name="_criteria/_ref[1]/_expr/resid" value="" >
<input type="hidden" name="_criteria/_ref[1]/_expr/_op" value="=" >
<input type="hidden" name="_criteria/_ref[1]/_expr/" value="" >//在逻辑流赋值。



select b.* from SUDA_BUSINESS b ,SUDA_RESAUTH r where b.businessid = r.partyid 
and r.restype='emp' and r.resid='90660' and r.partytype='business' 




两种列编辑方法：
直接在这个编辑器编辑
Ctrl+k+l 大小写转化
Ctrl+Shift+l，列编辑模式。
Shift+右键，选中列。
Shift+右键，可以选中列中不对齐的部分将之删除！！！

b.BUSINESSID           as   businessid         ,                                  
b.BUSINESSFULLNAME     as   businessfullname   ,                                  
b.BUSINESSNAME         as   businessname       ,                                  
b.BUSINESSTYPE         as   businesstype       ,                                  
b.OPENUSER             as   openuser           ,                                  
b.OPENORG              as   openorg            ,                                  
b.STARTDATE            as   startdate          ,                                  
b.ENDDATE              as   enddate            ,                                  
b.ISOPEN               as   isopen             ,                                  
b.ISCHECK              as   ischeck            ,                                  
b.PROCESSNAME          as   processname        ,                                  
b.PROCESSID            as   processid          ,                                  
b.PROCESSFORMURL       as   processformurl     ,                                  
b.BUSINESSGUIDEID      as   businessguideid    ,                                  
b.BUSINESSICON         as   businessicon       ,                                  
b.STATUS               as   status             ,                                  
b.ATTACHMENTURL        as   attachmenturl      ,                                  
b.CREATETIME           as   createtime         ,                                  
b.CREATOR              as   creator            ,                



使用ULtraEdit：菜单栏->列->列编辑模式
b.BUSINESSID           as    businessid        ,
b.BUSINESSFULLNAME     as    businessfullname  ,
b.BUSINESSNAME         as    businessname      ,
b.BUSINESSTYPE         as    businesstype      ,
b.OPENUSER             as    openuser          ,
b.OPENORG              as    openorg           ,
b.STARTDATE            as    startdate         ,
b.ENDDATE              as    enddate           ,
b.ISOPEN               as    isopen            ,
b.ISCHECK              as    ischeck           ,
b.PROCESSNAME          as    processname       ,
b.PROCESSID            as    processid         ,
b.PROCESSFORMURL       as    processformurl    ,
b.BUSINESSGUIDEID      as    businessguideid   ,
b.BUSINESSICON         as    businessicon      ,
b.STATUS               as    status            ,
b.ATTACHMENTURL        as    attachmenturl     ,
b.CREATETIME           as    createtime        ,
b.CREATOR              as    creator           ,



改变列属性。


