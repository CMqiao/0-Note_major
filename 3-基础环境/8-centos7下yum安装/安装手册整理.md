# 101 环境部署

IP地址：192.168.1.101

## ip 端口配置

### 使用root用户登录

### 配置文件介绍

进入网卡设置文件夹：`cd /etc/sysconfig/network-scripts`

由于本次的机器有四个网卡，所以相应的有四个配置文件：
ifcfg-eno1 对应于网口1，以此类推。
```
ifcfg-eno1  ifcfg-eno4
ifcfg-eno2  ifcfg-lo    
ifcfg-eno3  ifdown
``` 

### 修改相关的配置文件

网线查找标记为1的网线插口上，所以，我们此次配置的是ifcfg-eno1 文件

修改配置文件如下：

```
YPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eno1
UUID=8d273987-bfe3-4b05-baa0-164d03cb3073
DEVICE=eno1
ONBOOT=yes
IPADDR=192.168.1.101
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=192.168.1.1

```

### 重启网卡

`service network restart` 命令重启网卡，生效刚刚修改ip地址

### 验证效果

`ping www.baidu.com` 测试网络连通性。


## jdk 安装

查看环境中是否已安装java环境  `yum list installed |grep java`

卸载原有jdk环境 `yum -y remove java-1.8.0-openjdk*`

列出jdk列表 `yum -y list java*`

安装jdk：`yum  install  java-1.8.0-openjdk   java-1.8.0-openjdk-devel`

*如果没有java-1.8.0-openjdk-devel就没有javac命令* *101上同时也安装了jdk7*

安装完成后，执行java -version 查看是否安装成功。

通过yum默认安装的路径为   `/usr/lib/jvm`

修改配置文件： `vi /etc/profile` 在文件末尾添加

```
JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk-1.8.0.171-8.b10.el7_5.x86_64
PATH=$PATH:$JAVA_HOME/bin
CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
export JAVA_HOME CLASSPATH PATH
```

是配置生效：`source /etc/profile`

验证安装： `java -version`

## mysql 安装

### 配置YUM源

在MySQL官网中下载YUM源rpm安装包：http://dev.mysql.com/downloads/repo/yum/ 

### 下载mysql源安装包
`wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm`

### 安装mysql源
`yum localinstall mysql57-community-release-el7-8.noarch.rpm`

检查mysql源是否安装成功

`yum repolist enabled | grep "mysql.*-community.*" `

显示如下内容，表示成功了！
```
!mysql-connectors-community/x86_64 MySQL Connectors Community                 51
!mysql-tools-community/x86_64      MySQL Tools Community                      63
!mysql57-community/x86_64          MySQL 5.7 Community Server                267
```

### 安装mysql

`yum install mysql-community-server`

### 启动mysql

`systemctl start mysqld`

### 开机启动
```
shell> systemctl enable mysqld
shell> systemctl daemon-reload
```

## mongodb 安装

### 配置仓库文件

`vi /etc/yum.repos.d/mongodb-org-3.4.repo`

然后复制下面配置,保存退出
```
[mongodb-org-3.4]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.4/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc
```

### 安装软件

`yum -y install mongodb mongodb-devel mongodb-server`

### 修改配置文件

`vim /etc/mongod.conf`

```
#bind_ip = 127.0.0.1
port=27017
fork = true
pidfilepath = /var/run/mongodb/mongod.pid
logpath = /var/log/mongodb/mongod.log
unixSocketPrefix = /var/run/mongodb
dbpath = /var/lib/mongodb
```

### 启停mongodb

`systemctl start/stop/restart mongod`

### 远程访问
记得关闭防火墙！
systemctl stop firewalld 

mongo 192.168.1.101:27017  //本次使用

### 开机启动
```
systemctl enable mongod
systemctl daemon-reload
```

## redis 安装

### 配置安装源

由于CentOS官方yum源里面没有Redis,这里我们需要安装一个第三方的yum源,这里用了Fedora的epel仓库

`yum install epel-release`

### 安装Redis

`yum install redis`

### 配置redis

#bind 127.0.0.1
protected-mode no
daemonize yes
requirepass password123

### 使用redis

`redis-cli -h 210.*.*.* -p 6379`

### 开机启动

```
systemctl enable redis
systemctl daemon-reload
```

## nfs 配置

## jenkins 部署

jenkins安装很简单，直接到jenkins包所在目录执行：  
`java -jar jenkins.war --httpPort=9999 &`

或者想下面这样，配置到开机自启动里：  
以wenhua用户启动，/etc/rc.local中配置  
`su - wenhua -c 'java -jar /app/jenkins/jenkins.war --httpPort=9999 &'`

这里要注意，用什么用户启动jenkins是有讲究的。不能随便用什么用户启动她。她会在当前启动用户的用户目录下新建jenkins工作目录。如：

`/home/wenhua/.jenkins/...`

`/home/wenhua/.jenkins/workspace/jxpt_pro/.var/genkins/jx/jwpt_pro`

## tomcat 安装

## 额外的配置：

session共享那个东西

tomcat必须是Tomcat8版本，JDK必须为JDK8版本。
   使用Tomcat8+redis的方式：
   首先，在Tomcat的lib目录下放入三个jar：jxpt-session-0.0.1.jar,jedis-2.9.0.jar,commons-pool2-2.4.2.jar
   其次，修改tomcat的context.xml，加入如下代码配置redis服务器路径:
```   
<Valve className="cn.ulearning.jxpt.session.RedisSessionHandlerValve" />
   <Manager className="cn.ulearning.jxpt.session.RedisSessionManager"
       host="*.*.*.*"
       port="6379"
       database="1"
       password="xxx"
       maxInactiveInterval="1800"/>
```
